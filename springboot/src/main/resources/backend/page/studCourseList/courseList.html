<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="../../plugins/element-ui/index.css" />
    <link rel="stylesheet" href="../../styles/common.css" />
    <link rel="stylesheet" href="../../styles/page.css" />
    <style>
        #member-app  .notAdmin::after{
            border: 0 !important;

        }
    </style>
</head>
<body>
<div class="dashboard-container" id="courseResult-app">
    <div class="container">
        <template >

	<span >
		当前,第
		<el-select @change="changeValue" v-model="value" placeholder="1" class="m-2" size="small">
		    <el-option
                    v-for="item in options"
                    :key="item.value"
                    :label="item.label"
                    :value="item.value"
            />
			</el-select>
			周
	</span>

                <el-table :data="timetable" :span-method="objectSpanMethod" border
                          :header-cell-style="{background:'#d9e5fd', color:'black', fontWeight: 1000}"
                          :cell-style="tableCellStyle"
                          style="overflow-x:hidden"
                >
                    <el-table-column prop="sjd" label="时间段" width="120" align="center">
                    </el-table-column>
                    <el-table-column prop="jc" label="节次" width="120" align="center">
                    </el-table-column>
                    <el-table-column prop="mon" label="星期一" align="center">
                        <template #default="scope">
                            <h4>{{ scope.row.mon.name }}</h4>
                        </template>
                    </el-table-column>
                    <el-table-column prop="tue" label="星期二" align="center">
                        <template #default="scope">
                            <h4>{{ scope.row.tue.name }}</h4>
                        </template>
                    </el-table-column>
                    <el-table-column prop="wed" label="星期三" align="center">
                        <template #default="scope">
                            <h4>{{ scope.row.wed.name }}</h4>
                        </template>
                    </el-table-column>
                    <el-table-column prop="thu" label="星期四" align="center">
                        <template #default="scope">
                            <h4>{{ scope.row.thu.name }}</h4>
                        </template>
                    </el-table-column>
                    <el-table-column prop="fri" label="星期五" align="center">
                        <template #default="scope">
                            <h4>{{ scope.row.fri.name }}</h4>
                        </template>
                    </el-table-column>
                    <el-table-column prop="sat" label="星期六" align="center">
                        <template #default="scope">
                            <h4>{{ scope.row.sat.name }}</h4>
                        </template>
                    </el-table-column>
                    <el-table-column prop="sun" label="星期日" align="center">
                        <template #default="scope">
                            <h4>{{ scope.row.sun.name }}</h4>
                        </template>
                    </el-table-column>
                </el-table>
        </template>
    </div>
</div>
<!-- 开发环境版本，包含了有帮助的命令行警告 -->
<script src="../../plugins/vue/vue.js"></script>
<!-- 引入组件库 -->
<script src="../../plugins/element-ui/index.js"></script>
<!-- 引入axios -->
<script src="../../plugins/axios/axios.min.js"></script>
<script src="../../js/request.js"></script>
<script src="../../api/studCourseList.js"></script>
<script>
    new Vue({
        el: '#courseResult-app',
        data () {
            return {
                options:[
                    {
                        value: 1,
                        label: 1,
                    },
                    {
                        value: 2,
                        label: 2,
                    },
                    {
                        value: 3,
                        label: 3,
                    },
                    {
                        value: 4,
                        label: 4,
                    },
                    {
                        value: 5,
                        label: 5,
                    },
                    {
                        value: 6,
                        label: 6,
                    },
                    {
                        value: 7,
                        label: 7,
                    },
                    {
                        value: 8,
                        label: 8,
                    },
                    {
                        value: 9,
                        label: 9,
                    },
                    {
                        value: 10,
                        label: 10,
                    },
                    {
                        value: 11,
                        label: 11,
                    },
                    {
                        value: 12,
                        label: 12,
                    },
                    {
                        value: 13,
                        label: 13,
                    },
                    {
                        value: 14,
                        label: 14,
                    },
                    {
                        value: 15,
                        label: 15,
                    },
                    {
                        value: 16,
                        label: 16,
                    },
                    {
                        value: 17,
                        label: 17,
                    },
                    {
                        value: 18,
                        label: 18,
                    },
                    {
                        value: 19,
                        label: 19,
                    },
                    {
                        value: 20,
                        label: 20,
                    },
                ],
                value: '',
                length:13,
                afternoonLength:5,
                timetable: [],
                events: [],
                hoverOrderArr: [],
                weeks: ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'],
                initTable:[],
                temp: [null,null,null,null,null,null,null],
            }
        },
        mounted () {

            const params ={
                    // studentId:this.$store.state.login_data.userSpecialInfo.studentInfo.studentId,
                    currentWeek:1
                }
            getLessonInfo(params).then(res=>{
                this.events=res.data;
                this.mergeData();
            });
        },
        created () {
            this.makeTimetable()
            this.initTable=this.timetable;
        },
        methods: {
            changeValue(val){
                console.log(val);

                const params={
                        // studentId:this.$store.state.login_data.userSpecialInfo.studentInfo.studentId,
                        currentWeek:val,
                    }
                getLessonInfo(params).then(res=>{
                    this.events=res.data;
                    this.makeTimetable();
                    this.mergeData();

                });
            },
            // 单元格添加背景色
            tableCellStyle ({ row, column, rowIndex, columnIndex } ) {
                if (row[column.property].name !== undefined) {
                    return {"background-color":"rgb(24 144 255 / 80%)","color": "#fff","border-radius":"10px"}
                }
            },
            // 构造课程表完整数据
            makeTimetable () {
                this.timetable = []
                for (let i = 0; i < this.length; i++) {
                    let one = {
                        sjd: '',
                        jc: i + 1,
                        mon: {},
                        tue: {},
                        wed: {},
                        thu: {},
                        fri: {},
                        sat: {},
                        sun: {}
                    }
                    if (i < 5) {
                        one.sjd = '上午'
                    } else if (i >= 5 && i < (this.afternoonLength + 5)) {
                        one.sjd = '下午'
                    } else {
                        one.sjd = '晚上'
                    }
                    this.timetable.push(one)
                }
            },
            mergeData(){
                console.log(this.events);
                // 合并数据,对这样就把每个星期的课都放到一起了啊
                if (this.events.length > 0) {
                    for (let i = 0; i < this.events.length; i++) {
                        // 获取星期几
                        let week = this.weeks[this.events[i].week - 1]
                        this.timetable[this.events[i].lessonStart - 1][week] = this.events[i]
                    }
                }
            },
            objectSpanMethod ({ row, column, rowIndex, columnIndex }) {
                if (columnIndex === 0) {
                    if (rowIndex < 5) {
                        if (rowIndex === 0) {
                            return {
                                rowspan: 5,
                                colspan: 1
                            }
                        } else {
                            return {
                                rowspan: 0,
                                colspan: 0
                            }
                        }
                    } else if (rowIndex > 4 && rowIndex < (4 + this.afternoonLength)) {
                        if (rowIndex === 5) {
                            return {
                                rowspan: this.afternoonLength,
                                colspan: 1
                            }
                        } else {
                            return {
                                rowspan: 0,
                                colspan: 0
                            }
                        }
                    } else {
                        if (rowIndex === (5 + this.afternoonLength)) {
                            return {
                                rowspan: this.length - 5 - this.afternoonLength,
                                colspan: 1
                            }
                        } else {
                            return {
                                rowspan: 0,
                                colspan: 0
                            }
                        }
                    }
                }
                if (columnIndex === 2) {
                    if (row.mon.name !== undefined) {
                        console.log(row.mon.name)
                        this.temp[0]=row.mon;
                        return {
                            rowspan: row.mon.lessonEnd - row.mon.lessonStart + 1,
                            colspan: 1
                        }
                    } else {
                        if(this.temp[0]==null){
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }
                        if(rowIndex>=this.temp[0].lessonStart&&rowIndex<this.temp[0].lessonEnd){
                            if(rowIndex==this.temp[0].lessonEnd-1){
                                this.temp[0]=null;
                            }
                            return{
                                rowspan: 0,
                                colspan: 0,
                            }
                        }else{
                            this.temp[0]=null;
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }

                    }
                }
                if (columnIndex === 3) {

                    if (row.tue.name !== undefined) {
                        this.temp[1]=row.tue;
                        return {
                            rowspan: row.tue.lessonEnd - row.tue.lessonStart + 1,
                            colspan: 1
                        }
                    } else {


                        if(this.temp[1]==null){
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }
                        if(rowIndex>=this.temp[1].lessonStart&&rowIndex<this.temp[1].lessonEnd){
                            if(rowIndex==this.temp[1].lessonEnd-1){
                                this.temp[1]=null;
                            }
                            return{
                                rowspan: 0,
                                colspan: 0,
                            }
                        }else{
                            this.temp[1]=null;
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }

                    }
                }
                if (columnIndex === 4) {
                    if (row.wed.name !== undefined) {
                        this.temp[2]=row.wed;
                        return {
                            rowspan: row.wed.lessonEnd - row.wed.lessonStart + 1,
                            colspan: 1
                        }
                    } else {
                        if(this.temp[2]==null){
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }
                        if(rowIndex>=this.temp[2].lessonStart&&rowIndex<this.temp[2].lessonEnd){
                            if(rowIndex==this.temp[2].lessonEnd-1){
                                this.temp[2]=null;
                            }
                            return{
                                rowspan: 0,
                                colspan: 0,
                            }
                        }else{
                            this.temp[2]=null;
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }

                    }
                }
                if (columnIndex === 5) {
                    if (row.thu.name !== undefined) {
                        this.temp[3]=row.thu;
                        return {
                            rowspan: row.thu.lessonEnd - row.thu.lessonStart + 1,
                            colspan: 1
                        }
                    } else {
                        if(this.temp[3]==null){
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }
                        if(rowIndex>=this.temp[3].lessonStart&&rowIndex<this.temp[3].lessonEnd){
                            if(rowIndex==this.temp[3].lessonEnd-1){
                                this.temp[3]=null;
                            }
                            return{
                                rowspan: 0,
                                colspan: 0,
                            }
                        }else{
                            this.temp[3]=null;
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }

                    }
                }
                if (columnIndex === 6) {
                    if (row.fri.name !== undefined) {
                        this.temp[4]=row.fri;
                        return {
                            rowspan: row.fri.lessonEnd - row.fri.lessonStart + 1,
                            colspan: 1
                        }
                    } else {
                        if(this.temp[4]==null){
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }
                        if(rowIndex>=this.temp[4].lessonStart&&rowIndex<this.temp[4].lessonEnd){
                            if(rowIndex==this.temp[4].lessonEnd-1){
                                this.temp[4]=null;
                            }
                            return{
                                rowspan: 0,
                                colspan: 0,
                            }
                        }else{
                            this.temp[4]=null;
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }

                    }
                }
                if (columnIndex === 7) {
                    if (row.sat.name !== undefined) {
                        this.temp[5]=row.sat;
                        return {
                            rowspan: row.sat.lessonEnd - row.sat.lessonStart + 1,
                            colspan: 1
                        }
                    } else {
                        if(this.temp[5]==null){
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }
                        if(rowIndex>=this.temp[5].lessonStart &&rowIndex<this.temp[5].lessonEnd){
                            if(rowIndex==this.temp[5].lessonEnd-1){
                                this.temp[5]=null;
                            }
                            return{
                                rowspan: 0,
                                colspan: 0,
                            }
                        }else{
                            this.temp[5]=null;
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }

                    }
                }
                if (columnIndex === 8) {
                    if (row.sun.name !== undefined) {
                        this.temp[6]=row.sun;
                        return {
                            rowspan: row.sun.lessonEnd - row.sun.lessonStart + 1,
                            colspan: 1
                        }
                    } else {
                        if(this.temp[6]==null){
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }
                        if(rowIndex>=this.temp[6].lessonStart&&rowIndex<this.temp[6].lessonEnd){

                            if(rowIndex==this.temp[6].lessonEnd-1){
                                this.temp[6]=null;
                            }
                            return{
                                rowspan: 0,
                                colspan: 0,
                            }
                        }else{
                            this.temp[6]=null;
                            return {
                                rowspan: 1,
                                colspan: 1,
                            }
                        }

                    }
                }
            }
        }
    })
</script>


<style scoped>
    .box-card{
        display: flex;
        height: 90%;
        width: 98%;
        position: absolute;
        right: 1%;
        bottom: 6%;
        flex-direction: column;
        align-items:flex-end;
    }
    .box-card /deep/ .el-card__body{
        height: 100%;
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
        margin: 0px;
        border: 0px;
        padding: 0px;
    }
    .el-select {
        width: 60px;
    }
</style>

</body>
</html>

